---
title: C#反射
date: 2022-05-20 21:58:10
tags:
    反射
categories:
    C#
---

# 反射

C#中的反射是指在运行时动态地获取类型信息并操作对象的能力。通过反射，我们可以在运行时获取一个类型的成员信息（如字段、属性、方法等），并且可以动态地创建对象、调用方法、获取或设置属性值等。

反射在C#中非常重要，因为它使得我们可以在运行时动态地加载和使用程序集中的类型，而不需要在编译时就知道这些类型的存在。这对于一些需要动态地加载和使用类型的场景非常有用，比如插件系统、ORM框架等。

在C#中，反射主要通过System.Reflection命名空间中的类和接口来实现。其中，Type类是反射的核心，它表示一个类型的元数据信息。通过Type类，我们可以获取一个类型的成员信息、创建对象、调用方法等。



## 反射获取程序集的三种方式：

1. **Assembly.Load()**：//这种方式只需要提供程序集的名称

   ```c#
   //反射
   //拿到Ace命名空间下的所有东西
   Assembly assembly = Assembly.Load("Ace");
   ```

2. **Assembly.LoadFile(path)**：//这种方式需要提供程序集完整的路径

   ```c#
   //通过路径获取
   string path = AppDomain.CurrentDomain.BaseDirectory + "Ace.dll";
   Assembly assembly = Assembly.LoadFile(pat
   ```

3. **Assembly.LoadFrom("Ace.dll")**：//需要程序集名称及其后缀名

   ```c#
   //通过程序集和后缀名
   Assembly assembly = Assembly.LoadFrom("Ace.dll");
   ```

   

## 获取类型

1. **assembly..GetTypes()**：//获取所有类型

   ```c#
   Assembly assembly = Assembly.LoadFrom("Ace.dll");
   Type[] types = assembly.GetTypes();//获取程序集里面所有的类型
   ```

2. **assembly.GetType("命名空间.类名")**：//命名空间.类名"获取指定类型

   ```c#
   Assembly assembly = Assembly.LoadFrom("Ace.dll");
   Type type = assembly.GetType("Ace.UltramanAce");//获取程序集里面指定类型
   ```

3. **type.GetProperties()**：//获取所有的属性

   ```c#
   Assembly assembly = Assembly.LoadFrom("Ace.dll");
   Type type = assembly.GetType("Ace.UltramanAce");//获取程序集里面指定类型
   PropertyInfo[] props = type.GetProperties();//获取所有的属性
   ```

4. **type.GetFields()**：//获取所有的字段

   ```c#
   Assembly assembly = Assembly.LoadFrom("Ace.dll");
   Type type = assembly.GetType("Ace.UltramanAce");//获取程序集里面指定类型
   FieldInfo[] fieldInfos =  type.GetFields();//获取所有的字段
   ```

5. **type.GetMethods()**：//获取所有的方法

   ```c#
   Assembly assembly = Assembly.LoadFrom("Ace.dll");
   Type type = assembly.GetType("Ace.UltramanAce");//获取程序集里面指定类型
   MethodInfo[] methodInfos =  type.GetMethods();//获取所有的方法
   ```

6. **assembly.CreateInstance("命名空间.类名")**：//实例化

   - 自带的Createinstance实例化对象是需要指名名命名空间和类名 ➡只能获取到无参数的构造函数

   ```c#
   //-------------------------实例化-------------------------
   //dynamic 动态渲染
   //只有系统运行到这里才会渲染，之前写什么都不会报错，实际运行如果写错才会报错
   dynamic d = assembly.CreateInstance("Ace.UltramanAce");
   Object o = assembly.CreateInstance("Ace.UltramanAce");
   d.Name = "艾斯奥特曼";
   o.Name = "艾斯奥特曼";//会报错,不会动态渲染
   ```

7. **多态的使用**

   ```c#
   IUltraman ace = (IUltraman)assembly.CreateInstance("Ace.UltramanAce");
   ace.Name = "艾斯奥特曼";
   string res = ace.Attack();
   ```

   

